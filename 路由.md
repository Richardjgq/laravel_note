# HTTP路由

## 基本路由

最基本的Laravel路由只接收一个URI和一个闭包,并以此提供一个非常简单且优雅的定义路由方法:

```
Route::get('foo', function () {
    return 'Hello World';
});
```

**默认路由文件**

所有路由都定义位于routes目录下的路由文件中,这些文件通过框架自动加载.

routes\/web.php文件定义了web界面的路由,这些路由被分配给web中间件组,从而可以提供session和csrf防护等功能.

routes\/api.php中的路由是无状态的,被分配到api中间件组.

大部分应用都是从routes\/web.php文件开始定义路由的.

**有效的路由方法**

可以注册路由来响应任何HTTP请求:

```php
Route::get($uri, $callback);
Route::post($uri, $callback);
Route::put($uri, $callback);
Route::patch($uri, $callback);
Route::delete($uri, $callback);
Route::options($uri, $callback);
```

有时候还需要注册路由响应多个HTTP请求,可以通过match方法来实现.或者使用any方法注册一个路由来响应所有HTTP请求:

```
Route::match(['get', 'post'], '/', function(){
    //
});
Route::any('foo', function(){
    //
});
```

**CSRF防护**

在web路由文件中所有请求方式PUT,POST或DELETE的HTML表单都会包含一个CSRF令牌字段,否则请求会被拒绝.

```
<form method="POST" action="/profile">
    {{csrf_field()}}
    ...
</form>
```

### **路由参数**

**必选参数**

有时需要在路由中捕获URI片段.比如从URL中捕获用户ID:

```
Route::get('user/{id}', function ($id) {
    return 'User ' . $id;
});
```

当然,可以按需要在路由中定义多个路由参数:

```
Route::get('posts/{post}/comments/{comment}', function ($postId, $commentId) {
    return $postId.$commentId;
});
```

路由参数总是通过花括号进行包裹,这些参数在路由被执行时会被传递到路由的闭包.

> 注:路由参数不能包含`-`字符,需要的话可以使用`_`替代.

**可选参数**

如果需要指定可选的路由参数,通过在参数名后加一个`?`标记来实现,同时给相应的变量指定默认值:

```
Route::get('user/{name?}', function ($name = null) {
    return $name;
});
Route:get('user/{name?}', function ($name = 'John') {
    return $name;
});
```

### 命名路由

命名路由为生成URL或重定向提供了便利.实现也很简单,在路由定义之后使用name方法链的方式来实现:

```
Route::get('user/profile', function () {
    //
})->name('profile');
```

还可以为控制器动作指定路由名称:

```
Route::get('user/profile', 'UserController@showProfile')->name('profile');
```

**为命名路由生成URL**

为给定路由分配名称之后,就可以通过辅助函数route为该命名路由生成URL了:

```php
$url = route('profile');
$redirect = redirect()->route('profile');
```

如果命名路由定义了参数,可以将该参数作为第二个参数传递给route函数.给定的路由参数将会自动插入到URL中:

```php
Route::get('user/{id}/profile', ['as' => 'profile', function ($id) {
    //
}]);
$url = route('profile', ['id' => 1]);
```

### 路由群组

路由群组允许在多个路由中共享路由属性,比如中间件和命名空间等,这样就不用每个路由单独定义属性了.共享属性以数组的形式作为第一个参数被传递给Route::group方法.

**中间件**

要给路由群组中定义的所有路由分配中间件,可以在群组属性数组中使用 `middleware.`中间件将会按照数组中定义的顺序依次执行:

```
Route::group(['middleware' => 'auth'], function () {
    Route::get('/', function () {
        // 使用Auth中间件
    });
    Route::get('user/profile', function () {
        // 使用Auth中间件
    });
});
```

**命名空间**

另一个通用的例子是路由群组分配同一个PHP命名空间给其下的多个控制器,可以在分组属性数组中使用`namespace`来指定群组中所有控制器的公共命名空间:

```
Route::group(['namespace' => 'Admin'], function () {
    // 控制器在"App\Http\Controllers\Admin"命名空间下
    Route::group(['namespace' => 'User'], function () {
        // 控制器在"App\Http\Controllers\Admin\User"命名空间下
    });
});
```

默认情况下,`RouteServiceProvider`引入你的路由文件并指定其下所有控制器类所在的默认命名空间`App\Http\Controllers.`因此,我们在定义的时候只需要指定命名空间 `App\Http\Controllers`之后的部分即可.

**子域名路由**

路由群组还可以被用于子域名路由通配符,子域名可以像 URI 一样被分配给路由参数,从而允许捕获子域名的部分用于路由或者控制器,子域名可以通过群组属性数组中的`domain`来指定:

```
Route::group(['domain' => '{account}.myapp.com'], function () {
    Route::get('user/{id}', function ($account, $id) {
        //
    });
});
```

**路由前缀**

群组属性`prefix`可以用来为群组中每个路由添加一个给定URI前缀.例如,你可以为所有路由URI添加`admin`前缀:

```
Route::group(['prefix' => 'admin'], function () {
    Route::get('users', function () {
        // 匹配 "/admin/users" URL
    });
});
```

### 路由模型绑定

注入模型ID到路由或控制器动作时,通常需要查询数据库才能获取相应的模型数据.Laravel 路由模型绑定让注入模型实例到路由变得简单.例如,你可以将匹配给定ID的整个`User`类实例注入到路由中,而不是直接注入用户ID.

**隐式绑定**

Laravel 会自动解析定义在路由或控制器动作\(变量名匹配路由片段\)中的Eloquent模型类型声明,例如:

```
Route::get('api/users/{user}', function (App\User $user) {
    return $user->email;
});
```

**显式绑定**

### 表单方法伪造

HTML表单不支持`PUT`、`PATCH` 或者 `DELETE` 请求方法.因此,当定义 `PUT`、`PATCH`或 `DELETE` 路由时,需要添加一个隐藏的`_method`字段到表单中,其值被用作该表单的HTTP 请求方法:

```
<form action="/foo/bar" method="POST">
    <input type="hidden" name="_method" value="PUT">
    <input type="hidden" name="_token" value="{{ csrf_token() }}">
</form>
```

还可以使用辅助函数method\_field来实现这一目的:

```
{{ method_field('PUT') }}
```

### 访问当前路由

你可以使用`Route`门面上的`current`、`currentRouteName`和 `currentRouteAction`方法来访问处理当前输入请求的路由信息:

```
$route = Route::current();
$name = Route::currentRouteName();
$action = Route::currentRouteAction();
```

