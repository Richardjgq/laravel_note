# 文章分类

**创建分类表**

    CREATE TABLE `head_category` (
      `cateid` int(11) unsigned NOT NULL AUTO_INCREMENT,
      `catename` varchar(50) DEFAULT '',
      `catetitle` varchar(255) DEFAULT '',
      `catekeywords` varchar(255) DEFAULT '',
      `catedescription` varchar(255) DEFAULT NULL,
      `cateview` int(10) DEFAULT '0',
      `cateorder` tinyint(4) DEFAULT '0',
      `catepid` int(11) DEFAULT '0',
      PRIMARY KEY (`cateid`)
    ) ENGINE=MyISAM DEFAULT CHARSET=utf8;

也可以使用数据迁移的方式创建表.先手动添加一些内容.

**添加资源路由**

```
Route::resource('category', 'CategoryController');
```

**创建资源控制器**

```
php artisan make:controller Admin/CategoryController --resource
```

**创建模型**

```
php artisan make:model Http/Model/Category
```

**编辑控制器**

```
# 引入模板
public function index()
{
    # 获取分类树
    $categorys = (new Category)->tree();
    # 返回模板发送分类树变量,发送变量名默认用data
    return view('admin.category.index')->with('data', $categorys);
}
```

**编辑模型**

```
protected$table='category';
protected$primaryKey='cateid';
public$timestamps=false;
# 获取分类数据方法
public function tree()
{
    $categorys = $this->orderBy('cateorder', 'asc')->get();
    $data = $this->getTree($categorys, 'catename','cateid', 'catepid');
    return $data;
}
# 整理分类数据
public function getTree($data, $field_name, $field_id, $field_pid, $pid = 0, $str = '┗ ')
{
    $tree = [];
    foreach ($data as $k => $v) {
        if ($v->$field_pid == $pid) {
            $tree[] = $data[$k];
            foreach ($data as $m => $n) {
                if ($n->$field_pid == $v->$field_id) {
                    $data[$m][$field_name] = $str.$data[$m][$field_name];
                    $tree[] = $data[$m];
                }
            }
        }
    }
    return $tree;
}
```



