# 请求

### 知识点整理

```
1.访问请求实例
    请求实例注入
    public function store(Request $request)
    依赖注入 & 路由参数
    public function update(Request $request,$id) # 路由参数写在后面即可
    通过路由闭包访问请求
    Route::get('/', function (Request $request) {//});
    请求路径 & 方法
        Illuminate\Http\Request继承自Symfony\Component\HttpFoundation\Request类
        提供了多个方法来检测应用的 HTTP 请求
        $uri=$request->path(); # 获取请求路径 foo/bar
        $url = $request->url(); # 不包含查询字符串 
        $url = $request->fullUrl(); # 包含查询字符串
        $method=$request->method(); # 获取请求方法
        $request->isMethod('post')
    
    PSR-7 请求
        引入类包
            composer require symfony/psr-http-message-bridge
            composer require zendframework/zend-diactoros
        讲Laravel的Request请求转化为兼容 PSR-7 的实现
        use Psr\Http\Message\ServerRequestInterface;

        Route::get('/', function (ServerRequestInterface $request) {
            //
        });
        
2.输入修整&正常化
    在App\Http\Kernel的全局中间件堆栈中引入了TrimStrings和ConvertEmptyStringsToNull中间件,第一个trim空格,第二个是空串返回null
3.获取请求输入
    获取所有输入值
    $input = $request->all();
    获取单个输入值
    $name = $request->input('name');
    $name = $request->input('name', 'Sally'); # 给个默认值
    $input = $request->input('products.0.name'); # 表单是数组时的访问方式
    $names = $request->input('products.*.name');
    通过动态属性获取输入
    $name = $request->name;
    获取JSON输入值,Content-Type 请求头被设置为 application/json
    $name = $request->input('user.name');
    获取输入的部分数据
    $input = $request->only(['username', 'password']); # 仅获取这两个值
    $input = $request->only('username', 'password');
    $input = $request->except(['credit_card']); # 获取除了这个值的其他值
    $input = $request->except('credit_card');
    $input = $request->intersect(['username', 'password']); # 获取确实存在的
    判断输入值是否存在
    if ($request->has('name')) {
        //
    }
    
    上一次请求输入
    在两次请求之间保存输入数据,一般用于数据校验失败后上一次请求的数据还是有用的,Laravel验证服务会自动调用
    Session
        $request->flash(); # 将当前输入存放到一次性Session,一次性Session的意思是取出则销毁
        $request->flashOnly('username', 'email'); # 将输入数据子集存放到session中
        $request->flashExcept('password');
        将输入存储到一次性session之后,重定向
        return redirect('form')->withInput($request->except('password'));
        
        取出上次请求数据
        $username = $request->old('username');
        全局函数中也有一个old(),可以用在blade模板中
        <input type="text" name="username" value="{{ old('username') }}">
        
    Cookie
        从请求中取出Cookie
        $value = $request->cookie('name');
        添加Cookie到响应
        return response('Hello World')->cookie(
            'name', 'value', $minutes
        );
        这里的cookie和原生的setcookie差不多
        return response('Hello World')->cookie(
            'name', 'value', $minutes, $path, $domain, $secure, $httpOnly
        );
        生成cookie实例
        用全局函数生成cookie实例cookie(),然后添加到响应实例
        $cookie = cookie('name', 'value', $minutes);
        return response('Hello World')->cookie($cookie);
    
4.上传文件
    获取上传的文件
    Illuminate\Http\Request实例提供的file方法或者动态属性来访问上传文件
    file方法返回Illuminate\Http\UploadedFile类的一个实例,继承自PHP标准库中SplFileInfo类
        $file = $request->file('photo');
        $file = $request->photo;
        使用 hasFile 方法判断文件在请求中是否存在
        if ($request->hasFile('photo')) {
            //...
        }
        验证文件是否上传成功
        if ($request->file('photo')->isValid()){
            //...
        }
        文件路径 & 扩展名
        $path = $request->photo->path();
        $extension = $request->photo->extension();
    保存上传的文件
        使用store保存上传文件,store方法接收一个文件保存的相对路径(相对于文件系统配置的根目录)
        第一个参数:相对于文件系统配置的根目录|第二个参数:用于存储文件的磁盘名称作为第二个参数,返回相对于根目录的文件路径
        $path = $request->photo->store('images');
        $path = $request->photo->store('images', 's3');
        使用storeAs方法,接收保存路径、文件名和磁盘名作为参数
        $path = $request->photo->storeAs('images', 'filename.jpg');
        $path = $request->photo->storeAs('images', 'filename.jpg', 's3');
```



