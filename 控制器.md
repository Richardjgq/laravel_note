# 控制器

将所有的请求处理逻辑都放在单个routes.php中显然是不合理的.控制器可以将相关的HTTP请求封装到一个类中进行处理.通常控制器存放在`app/Http/Controllers`目录中.

### 基本控制器

**定义控制器**

所有的Laravel控制器都应该继承自Laravel自带的控制器基类Controller,控制器基类提供了一些很方便的方法如middleware,用于添加中间件控制器动作:

```
<?php
namespace App\Http\Controllers;
use App\User;
use App\Http\Controllers\Controller;
class UserController extends Controller
{
    // 为指定用户显示详情
    public function showProfile($id)
    {
        return view('user.profile', ['user' => User::findOrFail($id)]);
    }
}
```

定义指向该控制器动作的路由:

```
Route::get('user/{id}', 'UserController@showProfile');
```

现在,如果一个请求匹配上面的路由URI,UserController的showProfile方法就会被执行.当然路由参数也会被传递给这个方法.

> 其实,控制器不一定要继承自基类.但那样的话就不能使用一些方法了.例如,middleware,validate,dispatch等.

**控制器&命名空间**

在定义控制器路由的时候,没有指定完整的控制器命名空间,值定义了`App\Http\Controllers`之后的部分.默认情况下,`RouteServiceProvider`将会在一个路由群组中载入`routes.php`文件,并且该路由群组指定了群组中路由控制器所在的命名空间.

如果在`App\Http\Controllers`目录下选择使用PHP命名空间嵌套或组织控制器,只需要使用相对于`App\Http\Controllers`命名空间的指定类名即可.所以,如果完整的控制器类是`App\Http\Controllers\Photos\Admin\Controllers`,就可以像这样注册路由:

```
Route::get('foo', 'Photos\AdminController@medhod');
```

**单动作控制器**

定义一个只处理一个动作的控制器,可以在这个控制器中定义\_\_invoke方法:

```
<?php
namespace App\Http\Controllers;
use App\User;
use App\Http\Controllers\Controller;

class ShowProfile extends Controller
{
    public function __invoke($id)
    {
        return view('user.profile', ['user' => User::findOrFail($id)]);
    }
}
```

为这个单动作控制器注册路由的时候,不需要指定方法:

```
Route::get('user/{$id}', 'ShowProfile');
```

### 控制器中间件

中间件可以像下面这样分配给控制器路由:

```
Route::get('profile', 'UserController@show')->middleware('auth');
```

将中间件放在控制器构造函数中更方便,在控制器的构造函数中使用middleware方法,可以很轻松的分配中间件给该控制器.还可以限定中间件应用到控制器类的指定方法:

```
<?php
class UserController extends Controller
{
    // 实例化一个新的UserControllers实例
    public function __construct()
    {
        $this->middleware('auth');
        $this->middleware('log')->only('index');
        $this->middleware('subscribed')->except('store');
    }
}
```

> 注:将中间件分配给多个控制器动作,这意味着控制器会变得越来越臃肿,可以考虑将控制器分割成更多,更小的控制器.

### 资源控制器

例如,要在应用中创建一个控制器,用于处理关于图片存储的HTTP请求,使用Artisan命令make:controller,就可以快速创建控制器:

```
php artisan make:controller PhotoController --resource
```

命令会生成一个控制器玩文件`app/Http/Controllers/PhotoController.php`,控制器包含了每一个资源操作对应的方法.

下面可以为这个控制器注册一个资源路由:

```
Route::resource('photos', 'PhotoController');
```



### 依赖注入&控制器

### 路由缓存

