# 验证

### 知识点整理

```
1.简介

控制器基类使用ValidatesRequests trait验证HTTP请求
2.快速应用
# 编写验证逻辑
这个trait在所有控制器中提供validate方法验证数据,通过继续,失败抛出异常返回错误信息,ajax请求返回json响应.(响应都是自动的)
$this->validate($request, [
    'title' => 'required|unique:posts|max:255',
    'body' => 'required',
]);
    ## 首次验证失败后中止后续规则验证
    使用bail规则,首次验证失败即终止
    ## 嵌套属性注意事项
    HTTP 请求中包含“嵌套”参数,使用点连接
    $this->validate($request, [
        'title' => 'required|unique:posts|max:255',
        'author.name' => 'required',
        'author.description' => 'required',
    ]);
    
# 显示验证错误信息
请求输入参数没有通过给定验证规则,会自动将用户重定向回上一个位置
所有验证错误信息会自动一次性存放到 Session
错误信息都是从session中获取的,而且自动绑定到视图,以$error变量存在
$errors 变量是一个Illuminate\Support\MessageBag 实例
注：$errors变量会通过web中间件组中的Illuminate\View\Middleware\ShareErrorsFromSession中间件绑定到视图，
如果使用了该中间件,那么$errors变量在视图中总是有效.

# 可选字段注意事项
因为TrimStrings 和 ConvertEmptyStringsToNull 中间件,需要将提交过来的可选字段标记为nullable.
像required一样,也要标记为nullable.
$this->validate($request, [
    'title' => 'required|unique:posts|max:255',
    'body' => 'required',
    'publish_at' => 'nullable|date',
]);
上面publish_at的规则的意思是,字段可以为 null 或者有效的日期格式.
## 自定义错误格式
自定义保存在 Session 中的验证错误信息的格式,需要重写controller基类中的formatValidationErrors方法
(注:需要引入Illuminate\Contracts\Validation\Validator)
## AJAX请求&验证
在 AJAX 请求中使用 validate 方法时,会自动生成一个包含验证错误信息的 JSON 响应,Http状态吗为422.

3.表单请求验证
创建表单请求


授权表单请求


自定义错误格式

自定义错误消息


4.手动创建验证器




```



