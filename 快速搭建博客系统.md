# 快速搭建博客系统

### 创建文章数据表及其模型

使用Artisan命令:

```
php artisan make:model --migration Post
```

上面的命令会做两件事:

* 在app目录下创建模型类App\Post;
* 创建用于创建posts表的迁移,文件位于database\/migrations目录下

编辑database\/migrations目录下刚生成的这个迁移文件内容如下:

```
<?php
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class CreatePostsTable extends Migration
{
    public function up()
    {
        Schema::create('posts', function (Blueprint $table) {
            $table->increments('id');
            $table->string('slug')->unique();
            $table->string('title');
            $table->text('content');
            $table->timestamps();
            $table->timestamps('published_at')->index();
        });
    }

    public function down()
    {
        Schema::drop('posts');
    }
}
```

在默认生成的迁移文件基础上新增四个额外的列:

* slug:将文章标题转化为URL的一部分,以利于SEO
* title:文章标题
* content:文章内容
* published\_at:文章正式发布时间

运行迁移命令:

```
php artisan migrate
```

最后修改生成的app\/Post.php文件:

```
<?php
namespace App;
use Illuminate\Database\Eloquent\Model;
class Post extends Model
{
    protected $dates = ['published_at'];
    public function setTitleAttribute($value)
    {
        $this->attributes['title'] = $value;
        if (!$this->exists) {
            $this->attributes['slug'] = str_slug($value);
        }
    }
}
```

### 使用测试数据填充文章表

这里用到了模型工厂功能

添加代码到database\/factories目录下的ModelFactory.php文件中:

```
$factory->define(App\Post::class, function ($faker) {
    return [
        'title' => $faker->sentence(mt_rand(3,10)),
        'content' => join("\n\n", $faker->paragraphs(mt_rand(3, 6))),
        'published_at' => $faker->dateTimeBetween('-1 month', '+3 days'),
    ];
});
```

然后修改database\/seeds目录下的DatabaseSeeder.php内容如下:

```
<?php
use Illuminate\Database\Seeder;
use Illuminate\Database\Eloquent\Model;
class DatabaseSeeder extends Seeder
{
    public function run()
    {
        Model::unguard();
        $this->call('PostTableSeeder');
    }
}

class PostTableSeeder extends Seeder
{
    public function run()
    {
        App\Post::truncate();
        factory(App\Post::class, 20)->create;
    }
}
```

运行命令

```
php artisan db:seed
```

